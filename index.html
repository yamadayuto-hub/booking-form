<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>é£¯è¡Œãæ—¥</title>

<!-- Instagram external browser force -->
<script>
(function(){
  const ua = navigator.userAgent || "";
  if(/Instagram/i.test(ua)){
    try{ window.open(location.href, "_blank"); }catch(e){}
  }
})();
</script>

<style>
  :root{
    --bg:#fbfbfb;
    --card:#ffffff;
    --muted:#8f8f8f;
    --accent:#111;
    --radius:12px;
    --gap:16px;
    --max-width:820px;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    background:var(--bg);
    font-family:"Noto Sans JP", -apple-system, system-ui, "Helvetica Neue", Arial;
    padding:26px 14px;
    display:flex;justify-content:center;
    -webkit-font-smoothing:antialiased;
  }
  .wrap{width:100%;max-width:var(--max-width);}

  .topbar{
    display:flex;justify-content:space-between;align-items:center;
    margin-bottom:26px;
  }
  .page-title{
    font-size:28px;font-weight:600;
  }
  .edit-name-btn{
    border:1px solid #e6e6e6;background:#fff;
    padding:8px 12px;border-radius:10px;font-size:14px;cursor:pointer;
  }

  /* headings */
  .section-title{
    font-size:18px;font-weight:700;
    margin:30px 0 10px;
    padding-left:4px;
  }

  /* card */
  .card{
    background:var(--card);
    border-radius:var(--radius);
    padding:18px;
    box-shadow:0 6px 24px rgba(20,24,28,0.06);
    margin-bottom:var(--gap);
  }

  label.muted{font-size:13px;color:var(--muted);display:block;margin-bottom:6px;}
  input[type="date"], select, button{
    width:100%;padding:10px 12px;font-size:15px;
    border-radius:10px;border:1px solid #eaeaea;background:#fff;
  }
  button.primary{
    background:var(--accent);color:#fff;border:0;font-weight:700;
    margin-top:14px;cursor:pointer;
  }

  /* branch item */
  .branch{
    border:1px solid #f1f1f1;
    border-radius:12px;padding:14px;
    margin-bottom:12px;background:#fff;
  }
  .branch-date{
    font-size:14px;color:#555;margin-bottom:6px;
  }
  .branch-title{
    font-size:16px;font-weight:700;display:flex;align-items:center;gap:6px;
    margin-bottom:6px;
  }
  .title-edit{cursor:pointer;}
  .branch-members{
    font-size:14px;color:#333;margin-bottom:10px;
    word-break:break-word;
  }
  .branch-actions{
    display:flex;gap:10px;
  }
  .branch-actions button{
    flex:1;padding:8px 0;border-radius:8px;font-size:14px;
    border:1px solid #ddd;background:#fff;cursor:pointer;
  }

  /* name modal */
  #nameModal{
    position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
    background:rgba(0,0,0,0.35);z-index:999;
    visibility:hidden;opacity:0;transition:opacity .25s;
  }
  #nameModal .inner{
    background:#fff;padding:22px;border-radius:12px;min-width:300px;
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <div class="page-title">é£¯è¡Œãæ—¥</div>
    <button class="edit-name-btn" id="editNameBtn">è¡¨ç¤ºåã‚’ä¿®æ­£</button>
  </div>

  <!-- æ–°ã—ãè¿½åŠ  -->
  <div class="section-title">æ–°ã—ãè¿½åŠ </div>
  <div class="card">
    <label class="muted">æ—¥ä»˜</label>
    <input type="date" id="newDate" min="2025-12-29" max="2026-01-04" />

    <label class="muted" style="margin-top:14px">æ™‚é–“å¸¯</label>
    <select id="newTime">
      <option value="æ˜¼">æ˜¼</option>
      <option value="å¤œ">å¤œ</option>
    </select>

    <label class="muted" style="margin-top:14px">å ´æ‰€</label>
    <select id="newPlace">
      <option value="æ©‹æœ¬">æ©‹æœ¬</option>
      <option value="å¤§é˜ª">å¤§é˜ª</option>
      <option value="äº¬éƒ½">äº¬éƒ½</option>
      <option value="ã©ã“ã§ã‚‚">ã©ã“ã§ã‚‚</option>
    </select>

    <button class="primary" id="createBtn">æ–°è¦ä½œæˆã—ã¦å‚åŠ </button>
  </div>

  <!-- ä»–ã®ç´„æŸ -->
  <div class="section-title">ä»–ã®ç´„æŸ</div>
  <div id="branchList"></div>
</div>

<!-- name modal -->
<div id="nameModal">
  <div class="inner">
    <div style="font-weight:700;font-size:16px;margin-bottom:8px">è¡¨ç¤ºåã‚’å…¥åŠ›</div>
    <div class="muted" style="margin-bottom:12px">ä»Šå¾Œè‡ªå‹•ã§ä½¿ã‚ã‚Œã¾ã™ï¼ˆå¾Œã§ä¿®æ­£å¯ï¼‰</div>
    <input id="nameInput" type="text" maxlength="20" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:10px;" />
    <button class="primary" id="saveNameBtn" style="margin-top:14px">ä¿å­˜</button>
  </div>
</div>

<script>
/*****************************************************************
 LocalStorage keys
*****************************************************************/
const STORAGE_KEY = "meal_branches";
const NAME_KEY = "meal_username";

/*****************************************************************
 PRESET BRANCHES
*****************************************************************/
function genId(){ return "b_" + Math.random().toString(36).slice(2,10); }

const PRESETS = [
  { id: genId(), date:"2025/12/29", time:"å¤œ", place:"å¤§é˜ª", title:"å¤§å­¦å¿˜å¹´ä¼š", members:["Hirao","ãƒˆã‚­ãƒ„","è—¤æœ¨"] },
  { id: genId(), date:"2026/01/03", time:"å¤œ", place:"äº¬éƒ½", title:"ä¸­å­¦åŒçª“ä¼š", members:["Ogawa","ã‹ãšã","MOE","Ami","yuina"] }
];

/*****************************************************************
 Read / Write
*****************************************************************/
function loadBranches(){
  try{
    const s = localStorage.getItem(STORAGE_KEY);
    return s ? JSON.parse(s) : null;
  }catch(e){ return null; }
}
function saveBranches(list){ localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }
function getName(){ return localStorage.getItem(NAME_KEY); }
function setName(v){ localStorage.setItem(NAME_KEY, v); }

/*****************************************************************
 Init data
*****************************************************************/
let branches = loadBranches();
if(!branches){ branches = PRESETS.slice(); saveBranches(branches); }

/*****************************************************************
 DOM refs
*****************************************************************/
const branchListEl = document.getElementById("branchList");
const newDateEl = document.getElementById("newDate");
const newTimeEl = document.getElementById("newTime");
const newPlaceEl = document.getElementById("newPlace");
const createBtn = document.getElementById("createBtn");
const editNameBtn = document.getElementById("editNameBtn");

const nameModal = document.getElementById("nameModal");
const nameInput = document.getElementById("nameInput");
const saveNameBtn = document.getElementById("saveNameBtn");

/*****************************************************************
 Name modal flow
*****************************************************************/
function openNameModal(){
  nameModal.style.visibility = "visible";
  nameModal.style.opacity = "1";
}
function closeNameModal(){
  nameModal.style.opacity = "0";
  setTimeout(()=> nameModal.style.visibility="hidden", 250);
}

(function initName(){
  const n = getName();
  if(!n){ openNameModal(); }
})();

saveNameBtn.onclick = ()=>{
  const v = (nameInput.value || "").trim();
  if(!v){ alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");return; }
  setName(v);
  closeNameModal();
  render();
};

editNameBtn.onclick = ()=>{
  const cur = getName() || "";
  const nv = prompt("è¡¨ç¤ºåã‚’ä¿®æ­£ï¼ˆæœ€å¤§20æ–‡å­—ï¼‰", cur);
  if(nv===null) return;
  const t = nv.trim().slice(0,20);
  if(!t){ alert("ç©ºã«ã¯ã§ãã¾ã›ã‚“"); return; }
  setName(t);
  render();
};

/*****************************************************************
 Format date
*****************************************************************/
function toShort(d){
  // input: YYYY/MM/DD â†’ output: YY/MM/DD
  const [y,m,dd] = d.split("/");
  return y.slice(2) + "/" + m + "/" + dd;
}

/*****************************************************************
 Sort branches
*****************************************************************/
function sortBranches(list){
  return list.slice().sort((a,b)=>{
    if(a.date === b.date){
      if(a.time === b.time) return 0;
      return a.time === "æ˜¼" ? -1 : 1;
    }
    return a.date < b.date ? -1 : 1;
  });
}

/*****************************************************************
 Render list
*****************************************************************/
function render(){
  branchListEl.innerHTML = "";
  const name = getName();
  const list = sortBranches(branches);

  list.forEach(br=>{
    const wrap = document.createElement("div");
    wrap.className = "branch";

    const dateEl = document.createElement("div");
    dateEl.className = "branch-date";
    dateEl.textContent = `${toShort(br.date)} / ${br.time} / ${br.place}`;

    const titleRow = document.createElement("div");
    titleRow.className = "branch-title";
    const t = document.createElement("span");
    t.textContent = br.title;
    const pencil = document.createElement("span");
    pencil.textContent = "ğŸ“";
    pencil.className = "title-edit";
    pencil.onclick = ()=>{
      const nt = prompt("ã‚¿ã‚¤ãƒˆãƒ«ã‚’ç·¨é›†", br.title);
      if(nt===null) return;
      const v = nt.trim();
      if(!v) return;
      br.title = v;
      saveBranches(branches);
      render();
    };
    titleRow.appendChild(t);
    titleRow.appendChild(pencil);

    const mem = document.createElement("div");
    mem.className = "branch-members";
    mem.textContent = br.members.join(", ");

    const acts = document.createElement("div");
    acts.className = "branch-actions";

    const joinBtn = document.createElement("button");
    joinBtn.textContent = "å‚åŠ ";
    const leaveBtn = document.createElement("button");
    leaveBtn.textContent = "å–ã‚Šæ¶ˆã—";

    joinBtn.onclick = ()=>{
      if(!name){ openNameModal(); return; }
      if(!br.members.includes(name)){
        br.members.push(name);
        saveBranches(branches);
        render();
      }
    };

    leaveBtn.onclick = ()=>{
      if(!name) return;
      br.members = br.members.filter(x=> x!==name);
      if(br.members.length===0){
        branches = branches.filter(x=> x.id!==br.id);
      }
      saveBranches(branches);
      render();
    };

    acts.appendChild(joinBtn);
    acts.appendChild(leaveBtn);

    wrap.appendChild(dateEl);
    wrap.appendChild(titleRow);
    wrap.appendChild(mem);
    wrap.appendChild(acts);

    branchListEl.appendChild(wrap);
  });
}
render();

/*****************************************************************
 Create branch
*****************************************************************/
createBtn.onclick = ()=>{
  const name = getName();
  if(!name){ openNameModal(); return; }

  const d = newDateEl.value;
  if(!d){ alert("æ—¥ä»˜ã‚’é¸ã‚“ã§ãã ã•ã„"); return; }
  const t = newTimeEl.value;
  const p = newPlaceEl.value;

  const d2 = d.replace(/-/g,"/");

  const br = {
    id: genId(),
    date: d2,
    time: t,
    place: p,
    title: "(ã‚¿ã‚¤ãƒˆãƒ«æœªè¨­å®š)",
    members: [name]
  };
  branches.push(br);
  saveBranches(branches);
  render();
};
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é£¯è¡Œãæ—¥</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
      background: #fafafa;
      color: #111;
      margin: 0;
      padding: 0;
    }

    /* å…¨ä½“ã‚»ãƒ³ã‚¿ãƒ¼ */
    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 24px 18px 80px;
    }

    h1 {
      text-align: center;
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 32px;
      letter-spacing: 0.03em;
    }

    /* è¦‹å‡ºã— */
    .section-title {
      font-size: 20px;
      font-weight: 600;
      margin: 40px 0 16px;
    }

    /* æ–°ã—ãè¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  */
    .add-box, .list-box {
      margin-bottom: 40px;
    }

    select, button, input[type="text"] {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-bottom: 12px;
      background: white;
    }

    button.primary {
      background: #111;
      color: white;
      font-weight: 600;
    }

    /* äºˆç´„ãƒ–ãƒ©ãƒ³ãƒ */
    .branch {
      background: #fff;
      padding: 14px 16px;
      border-radius: 10px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }

    .branch-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 16px;
      font-weight: 600;
    }

    .branch-title {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .branch-members {
      font-size: 14px;
      color: #444;
      margin-bottom: 10px;
    }

    .branch-actions {
      display: flex;
      gap: 10px;
    }

    .branch-actions button {
      flex: 1;
      font-size: 14px;
      padding: 10px;
    }

    /* å›ºå®šãƒœã‚¿ãƒ³ */
    .edit-name-btn {
      position: fixed;
      top: 18px;
      right: 18px;
      background: #eee;
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>é£¯è¡Œãæ—¥</h1>
  <a href="#" class="edit-name-btn" onclick="goNameEdit()">è¡¨ç¤ºåä¿®æ­£</a>

  <!-- æ–°ã—ãè¿½åŠ  -->
  <div class="add-box">
    <div class="section-title">æ–°ã—ãè¿½åŠ </div>

    <select id="new-date"></select>
    <select id="new-time">
      <option value="æ˜¼">æ˜¼</option>
      <option value="å¤œ">å¤œ</option>
    </select>
    <select id="new-place">
      <option value="æ©‹æœ¬">æ©‹æœ¬</option>
      <option value="å¤§é˜ª">å¤§é˜ª</option>
      <option value="äº¬éƒ½">äº¬éƒ½</option>
      <option value="ã©ã“ã§ã‚‚">ã©ã“ã§ã‚‚</option>
    </select>

    <button class="primary" onclick="addBranch()">è¿½åŠ ã™ã‚‹</button>
  </div>

  <!-- äºˆç´„ä¸€è¦§ -->
  <div class="list-box">
    <div class="section-title">ä»–ã®ç´„æŸ</div>
    <div id="branch-list"></div>
  </div>
</div>

<script>
/*********************************************************
 åˆå›ï¼šè¡¨ç¤ºåå…¥åŠ›ãƒšãƒ¼ã‚¸ã¸
*********************************************************/
if (!localStorage.getItem('displayName')) {
  window.location.href = 'name.html';
}

/*********************************************************
 åˆæœŸãƒ‡ãƒ¼ã‚¿
*********************************************************/
let branches = JSON.parse(localStorage.getItem('branches') || '[]');

// æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 
function loadPreset() {
  const preset = [
    { id: crypto.randomUUID(), date: '25/12/29', time: 'å¤œ', place: 'æ©‹æœ¬', title: 'å¤§å­¦å¿˜å¹´ä¼š', members: ['Hirao','ãƒˆã‚­ãƒ„','è—¤æœ¨'] },
    { id: crypto.randomUUID(), date: '26/01/03', time: 'å¤œ', place: 'äº¬éƒ½', title: 'ä¸­å­¦åŒçª“ä¼š', members: ['Ogawa','ã‹ãšã','MOE','Ami','yuina'] }
  ];
  if (!localStorage.getItem('presetLoaded')) {
    branches = branches.concat(preset);
    localStorage.setItem('presetLoaded','yes');
    localStorage.setItem('branches', JSON.stringify(branches));
  }
}
loadPreset();

/*********************************************************
 æ–°ã—ãè¿½åŠ ï¼šæ—¥ä»˜ç”Ÿæˆï¼ˆ25/12/29ã€œ26/01/04ï¼‰
*********************************************************/
function loadDateOptions() {
  const sel = document.getElementById('new-date');
  const start = new Date(2025,11,29);
  const end   = new Date(2026,0,4);
  let d = start;
  while (d <= end) {
    const y = String(d.getFullYear()).slice(2);
    const m = String(d.getMonth()+1).padStart(2,'0');
    const da = String(d.getDate()).padStart(2,'0');
    const opt = document.createElement('option');
    opt.value = `${y}/${m}/${da}`;
    opt.textContent = `${y}/${m}/${da}`;
    sel.appendChild(opt);
    d.setDate(d.getDate()+1);
  }
}
loadDateOptions();

/*********************************************************
 ãƒ–ãƒ©ãƒ³ãƒæç”»
*********************************************************/
function render() {
  const list = document.getElementById('branch-list');
  list.innerHTML = '';

  branches
    .sort((a,b)=> (a.date > b.date ? 1 : -1))
    .forEach(b => {
      const div = document.createElement('div');
      div.className = 'branch';

      div.innerHTML = `
        <div class="branch-header">
          <div class="branch-title">${b.date} / ${b.time} / ${b.place}ã€€${b.title} ğŸ“</div>
        </div>
        <div class="branch-members">${b.members.join(', ')}</div>
        <div class="branch-actions">
          <button onclick="joinBranch('${b.id}')">å‚åŠ </button>
          <button onclick="cancelBranch('${b.id}')">å–æ¶ˆ</button>
          <button onclick="editTitle('${b.id}')">ğŸ“</button>
        </div>
      `;

      list.appendChild(div);
    });
}
render();

/*********************************************************
 æ–°è¦è¿½åŠ 
*********************************************************/
function addBranch() {
  const date = document.getElementById('new-date').value;
  const time = document.getElementById('new-time').value;
  const place = document.getElementById('new-place').value;

  const newB = {
    id: crypto.randomUUID(),
    date, time, place,
    title: '',
    members: []
  };
  branches.push(newB);
  localStorage.setItem('branches', JSON.stringify(branches));
  render();
}

/*********************************************************
 å‚åŠ 
*********************************************************/
function joinBranch(id) {
  const name = localStorage.getItem('displayName');
  const b = branches.find(x=>x.id===id);
  if (!b.members.includes(name)) b.members.push(name);
  localStorage.setItem('branches', JSON.stringify(branches));
  render();
}

/*********************************************************
 å–æ¶ˆ
*********************************************************/
function cancelBranch(id) {
  const name = localStorage.getItem('displayName');
  const b = branches.find(x=>x.id===id);

  b.members = b.members.filter(m=>m!==name);

  // è‡ªåˆ†ã ã‘ãªã‚‰ãƒ–ãƒ©ãƒ³ãƒå‰Šé™¤
  if (b.members.length === 0) {
    branches = branches.filter(x=>x.id!==id);
  }

  localStorage.setItem('branches', JSON.stringify(branches));
  render();
}

/*********************************************************
 ã‚¿ã‚¤ãƒˆãƒ«ç·¨é›†
*********************************************************/
function editTitle(id) {
  const b = branches.find(x=>x.id===id);
  const t = prompt('ã‚¿ã‚¤ãƒˆãƒ«ã‚’ç·¨é›†', b.title || '');
  if (t !== null) {
    b.title = t;
    localStorage.setItem('branches', JSON.stringify(branches));
    render();
  }
}

/*********************************************************
 è¡¨ç¤ºåä¿®æ­£ãƒšãƒ¼ã‚¸ã¸
*********************************************************/
function goNameEdit() {
  window.location.href = 'name_edit.html';
}
</script>

</body>
</html>
