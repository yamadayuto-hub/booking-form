<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>é£¯è¡Œãæ—¥</title>

<!-- Instagram in-app browser â†’ å¼·åˆ¶ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ã‚¦ã‚¶ã¸ -->
<script>
  if (navigator.userAgent.includes("Instagram")) {
    window.location.href = location.href; 
  }
</script>

<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
    background: #f8f8f6;
    margin: 0;
    padding: 20px;
    color: #111;
    line-height: 1.7;
  }

  h1 {
    font-size: 26px;
    font-weight: 500;
    margin-bottom: 10px;
    opacity: 0;
    animation: fadeIn 1s forwards;
  }

  h2 {
    font-size: 18px;
    font-weight: 500;
    margin-top: 35px;
    opacity: 0;
    animation: fadeIn 1s forwards;
  }

  .section {
    margin-top: 20px;
    background: #ffffffc0;
    border-radius: 12px;
    padding: 15px 18px;
    backdrop-filter: blur(8px);
    box-shadow: 0 2px 12px #00000010;
    opacity: 0;
    animation: fadeIn 1s forwards;
  }

  .branch {
    padding: 12px 14px;
    margin: 12px 0;
    border-radius: 10px;
    background: #fff;
    border: 1px solid #e5e5e5;
    transition: 0.25s;
  }

  .branch:hover {
    background: #f0f0ee;
  }

  .participants {
    margin-top: 10px;
    padding-left: 15px;
    color: #444;
  }

  .join-btn {
    margin-top: 8px;
    display: inline-block;
    padding: 7px 14px;
    border: 1px solid #222;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.25s;
    font-size: 14px;
  }

  .join-btn:hover {
    background: #222;
    color: #fff;
  }

  input, select, button {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border-radius: 8px;
    border: 1px solid #bbb;
    background: white;
    font-size: 15px;
  }

  button {
    cursor: pointer;
    background: #111;
    color: white;
    margin-top: 15px;
    border-radius: 10px;
    transition: 0.3s;
  }

  button:hover {
    opacity: 0.8;
  }

  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(8px);}
    to   {opacity: 1; transform: none;}
  }
</style>
</head>

<body>

<h1>é£¯è¡Œãæ—¥</h1>

<!-- åå‰å…¥åŠ›ï¼ˆåˆå›ã®ã¿ï¼‰ -->
<div id="nameInputSection" class="section" style="display:none;">
  <h2>ã‚ãªãŸã®åå‰</h2>
  <p>ä»Šå¾Œè‡ªå‹•ã§ä½¿ã‚ã‚Œã‚‹ã®ã§1åº¦ã ã‘å…¥åŠ›ã—ã¦ãã ã•ã„</p>
  <input id="usernameInput" placeholder="åå‰ï¼ˆä¾‹: Yama23 / ã‚„ã¾ / ğŸ±ãªã©ï¼‰" />
  <button onclick="saveName()">ä¿å­˜</button>
</div>

<!-- ä»–ã®ç´„æŸãƒªã‚¹ãƒˆ -->
<h2>ä»–ã®ç´„æŸ</h2>
<div id="reservationList" class="section"></div>

<!-- æ–°è¦äºˆç´„ -->
<h2>æ–°ã—ãè¿½åŠ </h2>
<div class="section">
  <input id="newDate" type="date" />
  <input id="newTitle" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä¾‹ï¼šå¤§å­¦å¿˜å¹´ä¼šï¼‰" />
  <button onclick="addReservation()">è¿½åŠ ã™ã‚‹</button>
</div>

<script>
/* ==========================
   â‘  ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§åå‰ç®¡ç†
   ========================== */
let username = localStorage.getItem("username");

function saveName() {
  const name = document.getElementById("usernameInput").value.trim();
  if (!name) return alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
  localStorage.setItem("username", name);
  username = name;
  document.getElementById("nameInputSection").style.display = "none";
  render();
}

if (!username) {
  document.getElementById("nameInputSection").style.display = "block";
}

/* ==========================
   â‘¡ äºˆç´„ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚ãªãŸã®æŒ‡å®šã‚’ãƒ—ãƒªã‚»ãƒƒãƒˆï¼‰
   ========================== */

let reservations = JSON.parse(localStorage.getItem("reservations")) || {
  "2024-12-29": {
    title: "å¤§å­¦å¿˜å¹´ä¼š",
    members: ["Hirao", "ãƒˆã‚­ãƒ„", "è—¤æœ¨"]
  },
  "2025-01-03": {
    title: "ä¸­å­¦åŒçª“ä¼š",
    members: ["Ogawa", "ã‹ãšã", "MOE", "Ami", "yuina"]
  }
};

/* ==========================
   â‘¢ äºˆç´„ã‚’ä¿å­˜
   ========================== */
function saveReservations() {
  localStorage.setItem("reservations", JSON.stringify(reservations));
}

/* ==========================
   â‘£ äºˆç´„è¡¨ç¤ºï¼ˆç©ºãƒ‡ãƒ¼ã‚¿ã¯å‡ºã•ãªã„ï¼‰
   ========================== */
function render() {
  const list = document.getElementById("reservationList");
  list.innerHTML = "";

  const dates = Object.keys(reservations).sort();

  dates.forEach(date => {
    const data = reservations[date];
    if (!data.members.length) return;

    const box = document.createElement("div");
    box.className = "branch";

    const title = `${date} â€“ ${data.title}`;
    box.innerHTML = `<strong>${title}</strong>`;

    const p = document.createElement("div");
    p.className = "participants";
    p.innerHTML = data.members.join(", ");
    box.appendChild(p);

    // å‚åŠ ã™ã‚‹ãƒœã‚¿ãƒ³
    const join = document.createElement("div");
    join.className = "join-btn";
    join.textContent = "ã“ã“ã«å‚åŠ ã™ã‚‹";
    join.onclick = () => {
      if (!username) return alert("å…ˆã«åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      if (!data.members.includes(username)) {
        data.members.push(username);
        saveReservations();
        render();
      } else {
        alert("ã™ã§ã«å‚åŠ ã—ã¦ã„ã¾ã™");
      }
    };

    box.appendChild(join);
    list.appendChild(box);
  });
}

/* ==========================
   â‘¤ æ–°è¦äºˆç´„ã®è¿½åŠ 
   ========================== */
function addReservation() {
  const date = document.getElementById("newDate").value;
  const title = document.getElementById("newTitle").value.trim();

  if (!date || !title) return alert("æ—¥ä»˜ã¨ã‚¿ã‚¤ãƒˆãƒ«ã¯å¿…é ˆã§ã™");

  if (!reservations[date]) {
    reservations[date] = { title: title, members: [] };
  } else {
    reservations[date].title = title;
  }

  saveReservations();
  render();

  document.getElementById("newDate").value = "";
  document.getElementById("newTitle").value = "";
}

// åˆæœŸè¡¨ç¤º
render();
</script>

</body>
</html>
